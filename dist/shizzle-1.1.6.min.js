function Shizzle(e,t,a){"use strict";function i(){l(),n(),o(),s(),u(),f()}function l(){S.on("keyup change",function(e){w.filteredItems.length=0,b.empty(),_.forEach(w.items,function(t){t&&t[E]&&t[I]&&t[E].toLowerCase().indexOf(e.target.value.toLowerCase())>-1&&p(t)}),h(w.filteredItems)})}function n(){S.on("keypress",function(e){b.not(":visible")&&b.show()})}function o(){$(document).click(function(){b.hide()})}function s(){S.click(function(e){e.stopPropagation(),b.toggle()})}function u(){$(document).on("click","#shizzle-container-"+e+" .sz-choices li",function(){w.selectedItem={value:$(this).data("value"),text:$(this).text(),value2:$(this).attr("data-value-2"),value3:$(this).attr("data-value-3"),value4:$(this).attr("data-value-4")},S.val(""),S.focus(),b.toggle(),w.addPill(w.selectedItem),q&&q()})}function r(e){if(e&&0!==e.length){var t=[];return _.forEach(e,function(e){e&&e[E]&&e[I]&&t.push(e)}),t}}function c(e){if(e){if(!e.dataValue)throw new Error("dataValue is required");if(!e.dataText)throw new Error("displayText is required");I=e.dataValue,E=e.dataText,V=e.dataValue2,B=e.dataValue3,L=e.dataValue4}}function d(e,t){var a=document.createElement("div");a.id="shizzle-container-"+t,a.className="shizzlex",a.innerHTML="<ul class='shizzlex sz-pills'><li class='sz-search-box-container'><input type='text' search-box placeholder=\""+W+"\" class='sz-search-box' style='width: 100%; border: 0; outline: none; box-shadow: 0 0 0 #fff !important; -webkit-box-shadow: 0 0 0 #fff !important;'/></li></ul><ul class='shizzlex sz-choices'></ul>",v(a,e)}function h(e){if(e){b.empty();var t=_.uniqBy(e,I);_.forEach(t,function(e){e&&e[I]&&e[E]&&b.append("<li data-value='"+e[I]+"' data-value-2='"+e[V]+"' data-value-3='"+e[B]+"' data-value-4='"+e[L]+"'>"+e[E]+"</li>")})}}function f(){$(document).on("click","#shizzle-container-"+e+" .sz-pills li",function(e){var t={};t[I]=$(this).data("value"),t[E]=$(this).data("text"),t[V]=$(this).attr("data-value-2"),t[B]=$(this).attr("data-value-3"),t[L]=$(this).attr("data-value-4");var a=!0;$.isFunction(U)?U(t):a=U,a&&w.items.push(t),_.remove(w.pills,function(e){return e.value===t[I]}),$('[data-value="'+t[I]+'"]').remove(),h(_.sortBy(w.items,["text"])),S.focus(),H&&z(),A&&A()})}function p(e){var t=!1;_.forEach(w.filteredItems,function(a){a[I]===e[I]&&(t=!0)}),t||w.filteredItems.push(e)}function v(e,t){t.parentNode.insertBefore(e,t.nextSibling)}function z(){M&&(H=!0,0===w.pills.length?(w.$pillContainer.addClass(N),O&&x()):w.$pillContainer.removeClass(N))}function m(){var t=document.createElement("span");t.className="shizzlex sz-validation-message "+R,t.innerText=F,t.style.display="none",v(t,document.getElementById("shizzle-container-"+e))}function x(){$("."+R).show()}function g(){$("."+R).hide()}function y(e,t){var a=!1;if(t&&t.value)return _.forEach(e,function(e){e&&e.value&&(_.isString(e.value)?e.value.toLowerCase():e.value)===(_.isString(t.value)?t.value.toLowerCase():t.value)&&(a=!0)}),a}var w=this,e=e,S=null,b=null,C=null,E=null,I=null,V=null,B=null,L=null,T=null,k=!1,P=!1,q=null,A=null,D=null,M=!1,N=null,O=!1,R=null,F=null,H=!1,W="",U=!0;w.dataSource=null,w.items=[],w.filteredItems=[],w.pills=[],w.$pillContainer=null,function(){if(!e)throw new Error("id is required");if(!t)throw new Error("dataFields are required");c(t),a&&(T=a.data||null,k=a.itemsVisibleOnPageLoad||!1,q=a.onItemSelected||null,A=a.onPillRemoved||null,D=a.onItemsCleared||null,P=a.setToFocusOnPageLoad||!1,N=a.fieldErrorCss||null,M=a.isRequired||null,O=a.showValidationMessage||!1,R=a.validationMessageCss||null,F=a.validationMessageText||null,W=a.placeholder||"",U=a.shouldRepopulateOnRemove||!0),w.dataSource=_.sortBy(T,["text"]);var l=_.cloneDeep(w.dataSource);w.items=r(l),d(document.getElementById(e),e),b=$("#shizzle-container-"+e).find(".sz-choices"),S=$("#shizzle-container-"+e).find("[search-box]"),w.$pillContainer=$("#shizzle-container-"+e).find(".sz-pills"),M&&O&&m(),k?b.show():b.hide(),P&&S.focus(),w.items&&h(w.items),i()}(),this.addPill=function(t){if(t&&t.value&&t.text&&!y(w.pills,t)){w.pills.push(t);var a=document.createElement("li");a.setAttribute("data-id",t.id),a.setAttribute("data-text",t.text),a.setAttribute("data-value",t.value),a.setAttribute("data-value-2",t.value2),a.setAttribute("data-value-3",t.value3),a.setAttribute("data-value-4",t.value4),a.className="sz-pill",a.innerHTML="<span>"+t.text+"</span><span class='sz-close sz-hairline'></span>",$(a).insertBefore($("#shizzle-container-"+e).find("[search-box]").parent()),C=$("#shizzle-container-"+e).find(".sz-pill"),_.remove(w.items,function(e){return e[I]===t.value}),H&&z(),M&&O&&g(),h(w.items)}},this.clearData=function(){w.dataSource=null,w.items=null,w.pills.length=0,w.filteredItems.length=0,S.val(""),b.empty(),b.hide(),C&&C.remove(),D&&D()},this.populateWithData=function(e){w.dataSource=_.sortBy(e,["text"]),w.items=_.cloneDeep(w.dataSource),h(w.items)},this.validateControl=function(){z()}}Shizzle.prototype.getSelectedItems=function(){return this.pills},Shizzle.prototype.setSelectedItems=function(e){var t=this;_.forEach(e,function(e){t.addPill(e)})},Shizzle.prototype.clear=function(){this.clearData()},Shizzle.prototype.populate=function(e){this.populateWithData(e)},Shizzle.prototype.isValid=function(){return 0!==this.pills.length},Shizzle.prototype.fireValidation=function(){console.warn("fireValidation is deprecated since version 1.1.0 . Use validate() instead."),this.validateControl()},Shizzle.prototype.validate=function(){this.validateControl()};