function Shizzle(a,b,c){function x(){if(!a)throw new Error("id is required");if(!b)throw new Error("dataFields are required");E(b),c&&(l=c.data||null,m=c.itemsVisibleOnPageLoad||!1,o=c.onItemSelected||null,p=c.onPillRemoved||null,q=c.onItemsCleared||null,n=c.setToFocusOnPageLoad||!1,s=c.fieldErrorCss||null,r=c.isRequired||null,t=c.showValidationMessage||!1,u=c.validationMessageCss||nulll,v=c.validationMessageText||null),d.dataSource=_.sortBy(l,["text"]),d.items=_.cloneDeep(d.dataSource);var g=document.getElementById(a);F(g,a),f=$("#shizzle-container-"+a).find(".choices"),e=$("#shizzle-container-"+a).find(".search-box"),d.$pillContainer=$("#shizzle-container-"+a).find(".pills"),r&&t&&N(),m?f.show():f.hide(),n&&e.focus(),d.items&&G(d.items),y()}function y(){z(),A(),B(),C(),D(),H()}function z(){e.on("keyup change",function(a){d.filteredItems.length=0,f.empty(),_.forEach(d.items,function(b){b[h].toLowerCase().indexOf(a.target.value.toLowerCase())>-1&&J(b)}),G(d.filteredItems)})}function A(){e.on("keypress",function(a){f.not(":visible")&&f.show()})}function B(){$(document).click(function(){f.hide()})}function C(){e.click(function(a){a.stopPropagation(),f.toggle()})}function D(){$(document).on("click","#shizzle-container-"+a+" .choices li",function(){d.selectedItem={value:$(this).data("value"),text:$(this).text(),value2:$(this).attr("data-value-2"),value3:$(this).attr("data-value-3")},e.val(""),e.focus(),f.toggle(),I(d.selectedItem),o&&o()})}function E(a){if(a){if(!a.dataValue)throw new Error("dataValue is required");if(!a.dataText)throw new Error("displayText is required");i=a.dataValue,h=a.dataText,j=a.dataValue2,k=a.dataValue3}}function F(a,b){var c=document.createElement("div");c.id="shizzle-container-"+b,c.className="shizzlex",c.innerHTML="<ul class='shizzlex pills'><li class='search-box-container'><input type='text' class='search-box'/></li></ul><ul class='shizzlex choices'></ul>",K(c,a)}function G(a){a&&(f.empty(),_.forEach(a,function(a){f.append("<li data-value='"+a[i]+"' data-value-2='"+a[j]+"' data-value-3='"+a[k]+"'>"+a[h]+"</li>")}))}function H(){$(document).on("click","#shizzle-container-"+a+" .pills li",function(a){var b={};b[i]=$(this).data("value"),b[h]=$(this).data("text"),b[j]=$(this).attr("data-value-2"),b[k]=$(this).attr("data-value-3"),d.items.push(b),_.remove(d.pills,function(a){return a.value===b[i]});var c=$('[data-value="'+b[i]+'"]');c.remove(),G(_.sortBy(d.items,["text"])),e.focus(),w&&M(),p&&p()})}function I(b){d.pills.push(b);var c=document.createElement("li");c.setAttribute("data-id",b.id),c.setAttribute("data-text",b.text),c.setAttribute("data-value",b.value),c.setAttribute("data-value-2",b.value2),c.setAttribute("data-value-3",b.value3),c.className="pill",c.innerHTML="<span>"+b.text+"</span><span class='close hairline'></span>",$(c).insertBefore($("#shizzle-container-"+a).find(".search-box").parent()),g=$("#shizzle-container-"+a).find(".pill"),_.remove(d.items,function(a){return a[i]===b.value}),w&&M(),r&&t&&P(),G(d.items)}function J(a){var b=!1;_.forEach(d.filteredItems,function(c){c[i]===a[i]&&(b=!0)}),b||d.filteredItems.push(a)}function K(a,b){b.parentNode.insertBefore(a,b.nextSibling)}function L(){d.dataSource=null,d.items=null,d.pills.length=0,d.filteredItems.length=0,e.val(""),f.empty(),f.hide(),g&&g.remove(),q&&q()}function M(){r&&(w=!0,0===d.pills.length?(d.$pillContainer.addClass(s),t&&O()):d.$pillContainer.removeClass(s))}function N(){var b=document.createElement("span");b.className="shizzlex validation-message "+u,b.innerText=v,b.style.display="none";var c=document.getElementById("shizzle-container-"+a);K(b,c)}function O(){$("."+u).show()}function P(){$("."+u).hide()}var d=this,a=a,e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=!1,n=!1,o=null,p=null,q=null,r=!1,s=null,t=!1,u=null,v=null,w=!1;d.dataSource=null,d.items=[],d.filteredItems=[],d.pills=[],d.$pillContainer=null,x(),this.populateWithData=function(a){d.dataSource=_.sortBy(a,["text"]),d.items=_.cloneDeep(d.dataSource),G(d.items)},this.clearData=function(){L()},this.fireValidation=function(){M()}}Shizzle.prototype.getSelectedItems=function(){return this.pills},Shizzle.prototype.clear=function(){this.clearData()},Shizzle.prototype.populate=function(a){this.populateWithData(a)},Shizzle.prototype.isValid=function(){return 0!==this.pills.length},Shizzle.prototype.fireValidation=function(){this.fireValidation()};